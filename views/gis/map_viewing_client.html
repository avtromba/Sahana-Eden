{{extend 'layout.html'}}

<!--
    ol_js_loaders.html <- done
    ol_toolbar2.html <- replaced by MapFish toolbar: mf_toolbar.html
    ol_start_vars.js
    ol_layers_all.js
    ol_show_features_markers.js
    ol_controls.js <- done
    ol_controls_add_edit.js
    // Called to end the onload function
    ol_onload_fin.js
    ol_generate_add_feature_with_popup.js
    ol_functions.js <- done
    ol_status.html <- done
-->

{{include 'gis/ol_js_loaders.html'}}

{{include 'gis/ol_start_vars.js'}}

function centerMap() {
	if (!centered) {
		this.setCenter(point.transform(proj4326, this.getProjectionObject()), zoom);
		centered = true;
	}
}

function addLayers(map) {
    {{include 'gis/ol_layers_all.js'}}
}

{{include 'gis/mf_toolbar.js'}}

{{include 'gis/ol_functions2.js'}}

Ext.onReady(function() {

    map = new OpenLayers.Map('center',options);
	addLayers(map);
	{{include 'gis/ol_controls.js'}}
    toolbar = createToolbar(map);

    // 'Scribble' mode layer
	vectorLayer = new OpenLayers.Layer.Vector("vector", { 
		displayInLayerSwitcher: false
	});
	map.registerEvents(vectorLayer);
	
	// For making a custom LayerTree
    //treeModel = createTreeModel();
	
    var win = new Ext.Window({
		//title    : 'Sahana Map Viewing Client',
		closable : true,
		collapsible : true,
		maximizable : true,
		titleCollapse : true,
		width    : {{=width}},
		height   : {{=height}},
		plain    : true,
		layout   : 'border',
		listeners: {
                    afterlayout: centerMap,
					scope: map
                },
		items    : [{
                    region: "west",
                    id: "tools",
                    title: "{{=T("Tools")}}",
                    border: true,
                    width: 250,
                    collapsible: true,
                    split: true,
                    items: [{
                        id: "tree",
                        title: "{{=T("Layer Tree")}}",
                        xtype: "layertree",
                        map: map,
                        height: 200,
                        showWmsLegend: true,
                        enableDD: true,
                        //model: treeModel
                    }]
                    //}, {
                    //    id: "shortcuts_container",
                    //    title: "Shortcuts",
                    //    height: 50,
                    //    items: [{
                    //        id: "shorcuts",
                    //        xtype: "shortcuts",
                    //        map: map,
                    //        store: createShortcutsStore(),
                    //        templates: {
                    //            header: new Ext.Template(""),
                    //            footer: new Ext.Template("")
                    //        }
                    //  }]
                    //}]
                }, {
                    region: "center",
                    id: "map",
                    layout: "fit",
                    split: true,
                    xtype: "mapcomponent",
                    map: map,
                    tbar: toolbar
                }, {
                    //region: "south",
                    //id: "search_grid",
                    //title: "{{=T("Search results")}}",
                    //split: true,
                    //collapsible: true,
                    //height: 200,
                    // 8.1
                    //xtype: "grid",
                    //store: gridStore,
                    //columns: [
                    //    {header: "Id", dataIndex: "fid", width: 25},
                    //    {header: "Name", dataIndex: "name", width: 200},
                    //    {header: "Elevation", dataIndex: "elevation"}
                    //],
                }]
	});

	win.show();
	initToolbarContent(toolbar);

});
//]]></script>

<table>
<tr><td id='btn-panel'>
<a href="{{=URL(r=request,c='gis',f='configs')}}">
<input type="button" id="configs-btn" value="{{=T("Configs")}}" />
</a>
</td><td id='btn-panel'>
<a href="{{=URL(r=request,c='gis',f='features')}}">
<input type="button" id="features-btn" value="{{=T("Features")}}" />
</a>
</td><td id='btn-panel'>
<a href="{{=URL(r=request,c='gis',f='import')}}">
<input type="button" id="import-btn" value="{{=T("Import")}}" />
</a>
</td><td id='btn-panel'>
<a href="{{=URL(r=request,c='gis',f='keys')}}">
<input type="button" id="keys-btn" value="{{=T("Keys")}}" />
</a>
</td><td id='btn-panel'>
<a href="{{=URL(r=request,c='gis',f='layers')}}">
<input type="button" id="layers-btn" value="{{=T("Layers")}}" />
</a>
</td><td id='btn-panel'>
<a href="{{=URL(r=request,c='gis',f='markers')}}">
<input type="button" id="markers-btn" value="{{=T("Markers")}}" />
</a>
</td><td id='btn-panel'>
<a href="{{=URL(r=request,c='gis',f='projections')}}">
<input type="button" id="projections-btn" value="{{=T("Projections")}}" />
</a>
</td></tr>
</table>

<div id="center"></div>
<div id="south">
{{include 'gis/ol_status.html'}}
</div>
