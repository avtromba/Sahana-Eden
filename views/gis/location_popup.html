{{extend 'layout_popup.html'}}
{{include '_popup.html'}}
{{if session.s3.security_policy==1:}}
    <script type="text/javascript">//<![CDATA[
    $(function() {
            // Hide the Admin row for simple security_policy
            $("#gis_location_admin__row").hide();
    });
    //]]></script>
{{else:}}
{{pass}}
{{if "or_office" in request.vars.caller:}}
    {{fc = db(db.gis_feature_class.name == "Office").select(limitby=(0, 1)).first().id}}
    <script type="text/javascript">//<![CDATA[
    // If coming from the OR then populate defaults for the fields & Hide unnecessary rows
    $(function() {
        //if (self.parent.$("input[name='_formname']").val().match("or_office")) {
        var location_name = self.parent.$('#or_office_name').val();
        if (location_name) {
            $("#gis_location_name").val(location_name);
            $("#gis_location_name__row").hide();
        }
        $("#gis_location_description__row").hide();
        $("#gis_location_level__row").hide();
        $("#gis_location_code__row").hide();
        //$("#gis_location_parent__row").hide();
        $("#gis_location_feature_class_id").val({{=fc}});
        $("#gis_location_feature_class_id__row").hide();
        // Use default Marker for Class
        $("#gis_location_marker_id__row").hide();
        $("#gis_location_gis_feature_type__row").hide();
        $("#gis_location_wkt__row").hide();
        $("#gis_location_osm_id__row").hide();
        
        // Provide tiered Location AutoCompletes
        //{include 'gis/location_autocomplete.js'}
        //}
    });
    //]]></script>
{{elif "hms_hospital" in request.vars.caller:}}
    {{fc = db(db.gis_feature_class.name == "Hospital").select(limitby=(0, 1)).first().id}}
    <script type="text/javascript">//<![CDATA[
    // If coming from the HMS then populate defaults for the fields & Hide unnecessary rows
    $(function() {
        //if (self.parent.$("input[name='_formname']").val().match("hms_hospital")) {
        var location_name = self.parent.$('#hms_hospital_name').val();
        if (location_name) {
            $("#gis_location_name").val(location_name);
            $("#gis_location_name__row").hide();
        }
        $("#gis_location_description__row").hide();
        $("#gis_location_level__row").hide();
        $("#gis_location_code__row").hide();
        //$("#gis_location_parent__row").hide();
        $("#gis_location_feature_class_id").val({{=fc}});
        $("#gis_location_feature_class_id__row").hide();
        // Use default Marker for Class
        $("#gis_location_marker_id__row").hide();
        $("#gis_location_gis_feature_type__row").hide();
        $("#gis_location_wkt__row").hide();
        $("#gis_location_osm_id__row").hide();
        //}
    });
    //]]></script>
{{else:}}
{{pass}}
{{include 'gis/feature_crud.js'}}
{{include 'gis/convert_gps.html'}}