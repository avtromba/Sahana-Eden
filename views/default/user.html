{{extend "layout.html"}}
<div id="home">
<h2>
{{if request.args[0] == "login":}}
 {{=T("Login")}}
{{elif request.args[0] == "register":}}
 {{form[0].insert(-4, TR(TD(LABEL(T("Mobile Phone:"))), INPUT(_name="mobile", _id="mobile"), TD(DIV(_class="tooltip", _title=T("Mobile Phone|Entering a phone number is optional, but doing so allows you to subscribe to receive SMS messages.")))))}}
 {{form.attributes['_id'] = 'regform'}}
 {{=T("Register")}}
{{elif request.args[0] == "profile":}}
 {{=T("Profile")}}
{{elif request.args[0] == "change_password":}}
 {{=T("Change Password")}}
{{elif request.args[0] == "retrieve_password":}}
 {{=T("Retrieve Password")}}
{{pass}}
</h2>
{{=form}}
{{if request.args[0] == "login":}}
 {{self_registration = db().select(db.s3_setting.self_registration).first().self_registration}}
 {{if self_registration:}}
    <p>
    <a class="action-btn" href="{{=URL(r=request, args="register")}}">{{=T("Register")}}</a>
    </p>
 {{pass}}
 <p>
 <a class="action-btn" href="{{=URL(r=request, args="retrieve_password")}}">{{=T("Lost Password")}}</a>
 </p>
{{pass}}
</div>
{{if request.args[0] == "register":}}
<script src="/{{=request.application}}/static/scripts/S3/jquery.pstrength-min.1.2.js" type="text/javascript"></script>
{{if session.s3.debug:}}
    <script src="/{{=request.application}}/static/scripts/S3/jquery.validate.js" type="text/javascript"></script>
{{else:}}
    <script src="/{{=request.application}}/static/scripts/S3/jquery.validate.pack.js" type="text/javascript"></script>
{{pass}}
<script type="text/javascript">
$(function() {
    $('.password').pstrength();
});
$(document).ready(function() {
    // validate signup form on keyup and submit
    //HACK
    var validator = $("#regform").validate({
        errorClass: "req",
        rules: {
            first_name: {
                required: true,
                },
            email: {
                required: true,
                email: true,
                //remote: "emailsurl"  // TODO
            },
            password: {
                required: true,
            },
            password_two: {
                required: true,
                equalTo: "#auth_user_password"
            },
        },
        messages: {
            firstname: "  {{=T("Enter your firstname")}}",
            password: {
                required: "  {{=T("Provide a password")}}",
            },
            password_two: {
                required: "  {{=T("Repeat your password")}}",
                equalTo: "  {{=T("Enter the same password as above")}}"
            },
            email: {
                required: "  {{=T("Please enter a valid email address")}}",
                minlength: "  {{=T("Please enter a valid email address")}}",
            },
        },
         errorPlacement: function(error, element) {
              error.appendTo( element.parent().next() );
         },
         submitHandler: function(form) {
                form.submit();
         }
    });
});

</script>
{{pass}}
