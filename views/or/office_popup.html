{{extend 'layout_popup.html'}}
{{include '_popup.html'}}
{{if session.s3.security_policy==1:}}
    <script type="text/javascript">//<![CDATA[
    $(function() {
            // Hide the Admin row for simple security_policy
            $("#or_office_admin__row").hide();
    });
    //]]></script>
{{pass}}

<script type="text/javascript">//<![CDATA[
$(document).ready(function () {
    $("#or_office_organisation_id").val("{{=session.s3.organisation_id}}");
    $("#or_office_organisation_id__row").hide();
});
//]]></script>
<script type="text/javascript">//<![CDATA[
$(function() {
    // Hide the real Input Field
    $("#or_office_organisation_id").hide();
    
    // Add a dummy field
    $("#or_office_organisation_id").after("<input id='dummy' class='ac_input' size=50 />");

    {{include 'or/organisation_autocomplete.js'}}

    // Populate the real Input when the Dummy is selected
    $("#dummy").result(function(event, data, formatted) {
        var newvalue = data.id;
        $("#or_office_organisation_id").val(newvalue);
    });     
});

// If submission succesful
{{if response.flash or response.confirmation:}}
    // Refresh the office list
    var url = '{{=URL(r=request, c='or', f='dashboard') + '/' + str(session.s3.organisation_id)}}';    
    self.parent.$("#or_office_list").load(url + " #or_office_list"); 
{{pass}}
//]]></script>

