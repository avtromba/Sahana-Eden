Ext.namespace("GeoExt.ux.geonames");GeoExt.ux.geonames.GeoNamesSearchCombo=Ext.extend(Ext.form.ComboBox,{map:null,width:350,listWidth:350,loadingText:"Search in Geonames...",emptyText:"Search location in Geonames",zoom:8,minChars:1,queryDelay:50,maxRows:"20",tpl:'<tpl for="."><div class="x-combo-list-item"><h1>{name}<br></h1>{fcodeName} - {countryName}</div></tpl>',lang:"en",countryString:"",continentCode:"",adminCode1:"",adminCode2:"",adminCode3:"",featureClassString:"",featureCodeString:"",tag:"",charset:"UTF8",hideTrigger:true,displayField:"name",forceSelection:true,queryParam:"name_startsWith",url:"http://ws.geonames.org/searchJSON?",initComponent:function(){GeoExt.ux.geonames.GeoNamesSearchCombo.superclass.initComponent.apply(this,arguments);var a="";if(this.countryString.length>0){a=a+this.countryString}if(this.featureClassString.length>0){a=a+this.featureClassString}if(this.featureCodeString.length>0){a=a+this.featureCodeString}this.store=new Ext.data.Store({proxy:new Ext.data.ScriptTagProxy({url:this.url+a,method:"GET"}),baseParams:{maxRows:this.maxRows,lang:this.lang,continentCode:this.continentCode,adminCode1:this.adminCode1,adminCode2:this.adminCode2,adminCode3:this.adminCode3,tag:this.tag,charset:this.charset},reader:new Ext.data.JsonReader({idProperty:"geonameId",root:"geonames",totalProperty:"totalResultsCount",fields:[{name:"geonameId"},{name:"countryName"},{name:"lng"},{name:"lat"},{name:"name"},{name:"fcodeName"},{name:"adminCode1"},{name:"fclName"},{name:"countryCode"},{name:"fcl"},{name:"fcode"},{name:"population"},{name:"adminName1"}]})});if(this.zoom>0){this.on("select",function(e,c,d){var b=new OpenLayers.LonLat(c.data.lng,c.data.lat);b.transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());this.map.setCenter(b,this.zoom)},this)}}});Ext.reg("gxux_geonamessearchcombo",GeoExt.ux.geonames.GeoNamesSearchCombo);